class E{constructor(){this.events={}}on(a,b){this.events[a]=this.events[a]||[],this.events[a].push(b)}emit(a,...b){this.events.hasOwnProperty(a)&&this.events[a].forEach(a=>a(...b))}}class V{constructor(a,b){this.x=a,this.y=b}normalize(){const a=this.calcAng();return this.x=Math.cos(a),this.y=Math.sin(a),this}copy(){return new V(this.x,this.y)}calcAng(){return Math.atan2(this.y,this.x)}add(a){return this.x+=a.x,this.y+=a.y,this}static add(a,b){const c=a.x+b.x,d=a.y+b.y;return new V(c,d)}sub(a){return this.x-=a.x,this.y-=a.y,this}static sub(a,b){const c=a.x-b.x,d=a.y-b.y;return new V(c,d)}dot(a){return this.x*a.x+this.y*a.y}static dot(a,b){return a.x*b.x+a.y*b.y}cross(a){return this.x*a.y-this.y*a.x}static cross(a,b){return a.x*b.y-a.y*b.x}multiply(a){return this.x*=a,this.y*=a,this}getMag(){return Math.sqrt(this.x*this.x+this.y*this.y)}getMagSq(){return this.x*this.x+this.y*this.y}setMag(a){return this.normalize(),this.multiply(a),this}limit(a){return this.getMagSq()>a*a&&this.setMag(a),this}setAng(a){return this.x=Math.cos(a),this.y=Math.sin(a),this}set(a,b){return this.x=a,this.y=b,this}}class RubIt extends E{constructor(a){super(),this.args={container_id:a.container_id||!1,type:a.type||"dynamic",area_width:a.area_width||"auto",area_height:a.area_height||"auto",outer_rad:a.outer_rad||"100px",inner_rad:a.inner_rad||"60px",outer_bg:a.outer_bg||"radial-gradient(#56CCF2 0%, #2F80ED 100%)",outer_border:a.outer_border||"none",inner_bg:a.inner_bg||"radial-gradient(#56CCF2 0%, #2F80ED 100%)",inner_border:a.inner_border||"1px solid #2F80ED"},this.build(),this.stylize(),this.init(),this.pressed=!1}build(){this.el_area=document.createElement("div"),this.el_area.classList.add("rubit_area"),this.el_container=document.createElement("div"),this.el_container.classList.add("rubit_container"),this.el_outer=document.createElement("div"),this.el_outer.classList.add("rubit_outer"),this.el_inner=document.createElement("div"),this.el_inner.classList.add("rubit_inner"),this.el_outer.appendChild(this.el_inner),this.el_container.appendChild(this.el_outer),this.el_area.appendChild(this.el_container),this.args.container_id?document.getElementById(this.args.container_id).appendChild(this.el_area):document.body.appendChild(this.el_area)}stylize(){const a={position:"relative",width:this.args.area_width,height:this.args.area_height,"box-sizing":"border-box"},b={position:"relative",display:"flex","justify-content":"center","align-items":"center",border:this.args.outer_border,background:this.args.outer_bg,"border-radius":"50%",width:this.args.outer_rad,height:this.args.outer_rad,"box-sizing":"border-box"},c={position:"relative",border:this.args.inner_border,background:this.args.inner_bg,"border-radius":"50%",width:this.args.inner_rad,height:this.args.inner_rad,"box-sizing":"border-box"};this.applyStyle(a,this.el_area),this.applyStyle({position:"relative",display:"inline-block","box-sizing":"border-box"},this.el_container),this.applyStyle(b,this.el_outer),this.applyStyle(c,this.el_inner)}applyStyle(a,b){for(const c in a)b.style[c]=a[c]}init(){const a=this.mouseDown.bind(this),b=this.mouseMove.bind(this),c=this.mouseUp.bind(this);document.addEventListener("mousedown",a),document.addEventListener("mousemove",b),document.addEventListener("mouseup",c),document.addEventListener("touchstart",a),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("touchend",c);const d=this.el_container.offsetTop,e=this.el_container.offsetLeft;this.center=new V(e,d),this.inner=new V(0,0)}dynamic(a){let b,c;a.changedTouches?(c=a.changedTouches[0].pageY-window.scrollY,b=a.changedTouches[0].pageX-window.scrollX):(c=a.pageY-window.scrollY,b=a.pageX-window.scrollX);const d=this.el_area.getBoundingClientRect(),e=c-d.top-this.el_container.offsetHeight/2,f=b-d.left-this.el_container.offsetWidth/2;this.el_container.style.top=`${e}px`,this.el_container.style.left=`${f}px`,this.center.set(f,e),this.emit("reposition")}mouseDown(a){a.preventDefault(),this.pressed=!0,"dynamic"===this.args.type&&this.dynamic(a),this.el_inner.style.transition="none",this.mouseMove(a),this.emit("press")}mouseMove(a){if(a.preventDefault(),this.pressed){let b,c;a.changedTouches?(c=a.changedTouches[0].pageY-window.scrollY,b=a.changedTouches[0].pageX-window.scrollX):(c=a.pageY-window.scrollY,b=a.pageX-window.scrollX);const d=this.el_area.getBoundingClientRect(),e=this.el_container.getBoundingClientRect(),f=c-d.top-e.height/2,g=b-d.left-e.width/2;this.inner.set(g,f);const h=V.sub(this.inner,this.center).limit(e.width/2);this.el_inner.style.top=`${h.y}px`,this.el_inner.style.left=`${h.x}px`;const i=h.x/(e.width/2),j=-h.y/(e.height/2),k={x:i,y:j,distance:Math.sqrt(i**2+j**2),angle:180*Math.atan2(j,i)/Math.PI};this.emit("move",k)}}mouseUp(a){a.preventDefault(),this.pressed=!1,this.el_inner.style.transition="all .1s ease-out 0s",this.el_inner.style.top=`0px`,this.el_inner.style.left=`0px`,this.emit("move",{x:0,y:0,distance:0,angle:0}),this.emit("release")}}